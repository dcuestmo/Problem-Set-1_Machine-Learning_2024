# Extraemos una lista que contenga el atributo href de cada uno de los nodos <a> de en los elementos <li>
links <- my_html%>%
html_elements("li")%>%
html_nodes("a")%>%
html_attr("href")
print(links)
# Observamos que esta lista contiene solo las extensiones finales y no el link completo. Ademas es necesario
# omitir el primer elemento de la lista correpondiente al index. Por tanto es necesario completar el link
links <- paste0('https://ignaciomsarmiento.github.io/GEIH2018_sample/', links[-1])
# 1.2 Se organiza la informacion en data.frame ---------------------------------
tabla_final <- data.frame()
# link = links[1]
for (link in links) {
#Ahora se extrae la tabla de datos para cada link utilizando el tml referenciado por el div especifico de la tabla
page <- read_html(link)
referencia <- page %>%
html_element("div.col-md-9") %>%
html_element("div") %>%
html_attr("w3-include-html")
url_tabla <- paste0(url, referencia)
chunk <- read_html(url_tabla)%>%
html_elements("table") %>%
html_table()
# Convertimos la tabla a un DataFrame
tabla_chunk <- as.data.frame(chunk)
print(paste("Total de columnas en este chunk:", ncol(tabla_chunk)))
tabla_final <- bind_rows(tabla_final, tabla_chunk)
}
# Observamos que el total de columnas en cada chunk es la misma que la tabla final, por lo cual
# podemos asumir que no hay variables unicas en algun chunk o duplicados debido a la extraccion.
ncol(tabla_final)
#Visualizamos las primeras observaciones
print(head(tabla_final))
# 2. Se guarda la informacion --------------------------------------------------
# Guardamos la tabla consolidada
setwd(paste0(wd,"/Base_Datos"))
#------------------------------------------------------------------------------#
#------------------------ CODIGO BASE - PROBLEM SET 1 -------------------------#
#------------------------------------------------------------------------------#
# El presente codigo permite:
# 1: Cambiar el directorio entre cada uno de los colaboradores del proyecto
# 2: Correr cada uno de los scripts utilizados en la resoluci?n del problem set 1.
# 0. Se borra la memoria y se cargan los paquetes ------------------------------
rm(list = ls())   # Borra la memoria
# Se cargan los paquetes de inter?s
library(pacman)
p_load(rio,              # Importaci?n y exportaci?n sencilla de datos
tidyverse,        # Colecci?n de paquetes para datos ordenados y gr?ficos (incluye ggplot2).
skimr,            # Resumen compacto y descriptivo de datos
visdat,           # Visualizaci?n de datos faltantes
corrplot,         # Gr?ficos de matrices de correlaci?n
stargazer,        # Generaci?n de tablas en formatos de salida como LaTeX, HTML o texto
rvest,            # Herramientas para web scraping
readxl,           # Importar archivos Excel
writexl,          # Exportar archivos Excel
boot,             # Aplicaci?n de m?todos de remuestreo (bootstrapping)
WVPlots,          # Gr?ficos para an?lisis de variables ponderadas
patchwork,        # Combinaci?n y organizaci?n de gr?ficos
gridExtra,        # Disposici?n de gr?ficos en cuadr?cula
ggplot2,          # Creaci?n de gr?ficos mediante gram?tica de gr?ficos
caret,            # Evaluaci?n y entrenamiento de modelos predictivos
visdat,           # Visualizar missings
patchwork,        # Diseño de graficos
naniar,
MASS,
data.table)       # Manipulaci?n eficiente de grandes conjuntos de datos
getwd() #Mirar directorio
# 1. Definicion del directorio -------------------------------------------------
ifelse(grepl("HP", getwd()),
wd <- "C:/Users/HP/OneDrive - Universidad Nacional de Colombia/Documentos/Diego/PEG/2024-2/Machine learning/Problem-Set-1_Machine-Learning_2024",
ifelse(grepl("JULIETH", getwd()),
wd <- "C:/Users/JULIETH/Documents/GitHub/Problem-Set-1_Machine-Learning_2024",
ifelse(grepl("Jorge", getwd()),
wd <- "C:/Users/juanp.rodriguez/Documents/GitHub/Problem_set_1",
ifelse(grepl("C:/Users/User", getwd()),
wd <- "C:/Users/User/OneDrive - Universidad de los Andes/Big Data y Machine Learning/Problem_set_1/Problem_set_1",
ifelse(grepl("/Users/aleja/", getwd()),
wd <- "Directorio",
ifelse(grepl("Steven Ramirez", getwd()),
wd <- "C:/Users/Steven Ramirez/OneDrive - Universidad de los Andes/Grupo - Econometría 1/Escritorio/Big Data/Problem-Set-1_Machine-Learning_2024",
wd <- "otro_directorio"))))))
#------------------------------------------------------------------------------#
#----------------------------- Script 1. Scraping -----------------------------#
#------------------------------------------------------------------------------#
# El presente codigo carga la informacion de la Gran Encuesta Integrada de Hogares
# (GEIH) del repositorio del docente de la materia Ignacio Sarmiento
# 0. Se define el directorio de extraccion de informacion ----------------------
url <- 'https://ignaciomsarmiento.github.io/GEIH2018_sample/'
browseURL(url)     # Podemos ingresar a la pagina y observar como se encuentra la pagina
vignette("rvest")  # Se carga la explicaci?n de "rvest"
# 1. Extraccion y manejo de la base de datos -----------------------------------
my_html = read_html(url)  # Lectura del enlace
# 1.1. Se extrae la informacion -------------------------------------------------
# Extraemos una lista que contenga el atributo href de cada uno de los nodos <a> de en los elementos <li>
links <- my_html%>%
html_elements("li")%>%
html_nodes("a")%>%
html_attr("href")
print(links)
# Observamos que esta lista contiene solo las extensiones finales y no el link completo. Ademas es necesario
# omitir el primer elemento de la lista correpondiente al index. Por tanto es necesario completar el link
links <- paste0('https://ignaciomsarmiento.github.io/GEIH2018_sample/', links[-1])
# 1.2 Se organiza la informacion en data.frame ---------------------------------
tabla_final <- data.frame()
# link = links[1]
for (link in links) {
#Ahora se extrae la tabla de datos para cada link utilizando el tml referenciado por el div especifico de la tabla
page <- read_html(link)
referencia <- page %>%
html_element("div.col-md-9") %>%
html_element("div") %>%
html_attr("w3-include-html")
url_tabla <- paste0(url, referencia)
chunk <- read_html(url_tabla)%>%
html_elements("table") %>%
html_table()
# Convertimos la tabla a un DataFrame
tabla_chunk <- as.data.frame(chunk)
print(paste("Total de columnas en este chunk:", ncol(tabla_chunk)))
tabla_final <- bind_rows(tabla_final, tabla_chunk)
}
# Observamos que el total de columnas en cada chunk es la misma que la tabla final, por lo cual
# podemos asumir que no hay variables unicas en algun chunk o duplicados debido a la extraccion.
ncol(tabla_final)
#Visualizamos las primeras observaciones
print(head(tabla_final))
# 2. Se guarda la informacion --------------------------------------------------
# Guardamos la tabla consolidada
setwd(paste0(wd,"/Base_Datos"))
fwrite(tabla_final,"Tabla_Final_GEIH.csv",row.names = FALSE)
export(tabla_final, "Tabla_webs.rds")
# Author: Juliet Molano
#------------------------------------------------------------------------------#
#---------Script 2. Filtro y seleccion de variables----------------------------#
#------------------------------------------------------------------------------#
# 1. Cargar base de datos  -----------------------------------------------------
setwd(paste0(wd,"/Base_Datos")) #DirectorioS
data_webs = import(file = "Tabla_Final_GEIH.csv")
names(data_webs) #Mirar nombres de las variables
str(data_webs) #Mirar bases de datos
summary(data_webs$depto) ## corroborando que sea Bogotá
table(data_webs$ocu) ##La base tiene ocupados y no ocupados
skim(data_webs) %>% head()
# 2. Filtrar la base de datos ---------------------------------------------------
#Filtrar la base para mayores de 18 años
data_webs <- data_webs %>%
filter(age>=18 & ## Mayores de edad
ocu==1) ## Empleados
nrow(data_webs) #16542 observaciones que cumplen con estas caracteristicas
# 3. Seleccion de las variables de interes --------------------------------------
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_salary_m, y_total_m, y_otros_m,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal, y_ingLab_m_ha, y_total_m_ha,
Experiencia=p6426,maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem =hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Salario_mensual = y_salary_m,
Ingreso_total = y_total_m,
Ingreso_hora = y_total_m_ha,
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c)
# 3. Seleccion de las variables de interes --------------------------------------
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_salary_m, y_total_m, y_otros_m,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal, y_ingLab_m_ha, y_total_m_ha,
Experiencia=p6426,maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem =hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Salario_mensual = y_salary_m,
Ingreso_total = y_total_m,
Ingreso_hora = y_total_m_ha,
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c)
# Author: Juliet Molano
#------------------------------------------------------------------------------#
#---------Script 2. Filtro y seleccion de variables----------------------------#
#------------------------------------------------------------------------------#
# 1. Cargar base de datos  -----------------------------------------------------
setwd(paste0(wd,"/Base_Datos")) #DirectorioS
data_webs = import(file = "Tabla_Final_GEIH.csv")
names(data_webs) #Mirar nombres de las variables
str(data_webs) #Mirar bases de datos
summary(data_webs$depto) ## corroborando que sea Bogotá
table(data_webs$ocu) ##La base tiene ocupados y no ocupados
skim(data_webs) %>% head()
# 2. Filtrar la base de datos ---------------------------------------------------
#Filtrar la base para mayores de 18 años
data_webs <- data_webs %>%
filter(age>=18 & ## Mayores de edad
ocu==1) ## Empleados
nrow(data_webs) #16542 observaciones que cumplen con estas caracteristicas
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_otros_m, y_ingLab_m_ha, y_total_m_ha,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal,
Experiencia=p6426,maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem =hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Salario_mensual = y_salary_m,
Ingreso_total = y_total_m,
Ingreso_hora = y_total_m_ha,
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c)
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_otros_m, y_ingLab_m_ha, y_total_m_ha,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal,
Experiencia=p6426,maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem =hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Ingreso_total = y_total_m,
Ingreso_hora = y_total_m_ha,
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c)
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_otros_m, y_ingLab_m_ha, y_total_m_ha,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal,
Experiencia=p6426,maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem =hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Ingreso_total = y_total_m,
Ingreso_hora = y_total_m_ha,
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c)
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_otros_m, y_ingLab_m_ha, y_total_m_ha,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal,
Experiencia=p6426, maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem = hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Ingreso_total = y_total_m_ha,  # Corrigiendo esta línea
Ingreso_hora = y_ingLab_m_ha,  # Asegurando consistencia
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c
)
# Author: Juliet Molano
#------------------------------------------------------------------------------#
#---------Script 2. Filtro y seleccion de variables----------------------------#
#------------------------------------------------------------------------------#
# 1. Cargar base de datos  -----------------------------------------------------
setwd(paste0(wd,"/Base_Datos")) #DirectorioS
data_webs = import(file = "Tabla_Final_GEIH.csv")
names(data_webs) #Mirar nombres de las variables
str(data_webs) #Mirar bases de datos
summary(data_webs$depto) ## corroborando que sea Bogotá
table(data_webs$ocu) ##La base tiene ocupados y no ocupados
skim(data_webs) %>% head()
# 2. Filtrar la base de datos ---------------------------------------------------
#Filtrar la base para mayores de 18 años
data_webs <- data_webs %>%
filter(age>=18 & ## Mayores de edad
ocu==1) ## Empleados
nrow(data_webs) #16542 observaciones que cumplen con estas caracteristicas
# 3. Seleccion de las variables de interes --------------------------------------
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_otros_m, y_ingLab_m_ha, y_total_m_ha,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal,
Experiencia=p6426, maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem = hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Ingreso_total = y_total_m_ha,  # Corrigiendo esta línea
Ingreso_hora = y_ingLab_m_ha,  # Asegurando consistencia
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c
)
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_otros_m, y_total_m, y_total_m_ha,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal,
Experiencia=p6426,maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem =hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Ingreso_total = y_total_m,
Ingreso_hora = y_total_m_ha,
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c)
# Author: Juliet Molano
#------------------------------------------------------------------------------#
#---------Script 2. Filtro y seleccion de variables----------------------------#
#------------------------------------------------------------------------------#
# 1. Cargar base de datos  -----------------------------------------------------
setwd(paste0(wd,"/Base_Datos")) #DirectorioS
data_webs = import(file = "Tabla_Final_GEIH.csv")
names(data_webs) #Mirar nombres de las variables
str(data_webs) #Mirar bases de datos
summary(data_webs$depto) ## corroborando que sea Bogotá
table(data_webs$ocu) ##La base tiene ocupados y no ocupados
skim(data_webs) %>% head()
# 2. Filtrar la base de datos ---------------------------------------------------
#Filtrar la base para mayores de 18 años
data_webs <- data_webs %>%
filter(age>=18 & ## Mayores de edad
ocu==1) ## Empleados
nrow(data_webs) #16542 observaciones que cumplen con estas caracteristicas
# 3. Seleccion de las variables de interes --------------------------------------
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_otros_m, y_total_m, y_total_m_ha,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal,
Experiencia=p6426,maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem =hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Ingreso_total = y_total_m,
Ingreso_hora = y_total_m_ha,
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c)
names(data_webs) #Mirar nombres de las variables
# Author: Juliet Molano
#------------------------------------------------------------------------------#
#---------Script 2. Filtro y seleccion de variables----------------------------#
#------------------------------------------------------------------------------#
# 1. Cargar base de datos  -----------------------------------------------------
setwd(paste0(wd,"/Base_Datos")) #DirectorioS
data_webs = import(file = "Tabla_Final_GEIH.csv")
names(data_webs) #Mirar nombres de las variables
str(data_webs) #Mirar bases de datos
summary(data_webs$depto) ## corroborando que sea Bogotá
table(data_webs$ocu) ##La base tiene ocupados y no ocupados
skim(data_webs) %>% head()
# 2. Filtrar la base de datos ---------------------------------------------------
#Filtrar la base para mayores de 18 años
data_webs <- data_webs %>%
filter(age>=18 & ## Mayores de edad
ocu==1) ## Empleados
nrow(data_webs) #16542 observaciones que cumplen con estas caracteristicas
# 3. Seleccion de las variables de interes --------------------------------------
data_webs <- data_webs %>%
select(directorio, secuencia_p, orden,  # variables de referenciación
age, sex, oficio, estrato1, p6050, # variables caracteristicas
relab, cuentaPropia, totalHoursWorked, sizeFirm, # caracteristicas empleo
y_otros_m, y_total_m, y_total_m_ha,  #ingresos
fex_c, # factor de expansión
hoursWorkUsual, formal, informal,
Experiencia=p6426,maxEducLevel #Adicionales
)%>%
rename(
Direccion = directorio,
Secuencia = secuencia_p,
Orden = orden,
Edad = age,
Sexo = sex,
Profesion = oficio,
Estrato = estrato1,
Posicion_hogar = p6050,
Tipo_ocupacion = relab,
Independiente = cuentaPropia,
Horas_trabajadas = totalHoursWorked,
Horas_trabajadas_sem =hoursWorkUsual,
Tamaño_empresa = sizeFirm,
Ingreso_total = y_total_m,
Ingreso_hora = y_total_m_ha,
Otros_ingresos = y_otros_m,
Nivel_educ = maxEducLevel,
Factor_expansion = fex_c)
